<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Will you be my Valentine?</title>

  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      --bg1: #ffd6e7;
      --bg2: #ffeef6;
      --card: #ffffffcc;
      --yes: #ff3b7a;
      --yesHover: #ff1f68;
      --text: #111827;

      /* Captcha theme */
      --capBlue: #1a73e8;
      --capBorder: #dadce0;
      --capBg: #f1f3f4;
      --capText: #202124;
      --capWarn: #b91c1c;
      --capOk: #047857;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      font-family: system-ui, sans-serif;
      overflow: hidden;
      padding: 16px;
      color: var(--text);
    }

    /* FULL-SCREEN CONFETTI CANVAS */
    #confettiCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9000;
    }

    #app.locked {
      filter: blur(2px);
      pointer-events: none;
      user-select: none;
    }

    .card {
      width: min(720px, 92vw);
      padding: 26px 22px 34px;
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: 22px;
      text-align: center;
      box-shadow: 0 18px 60px rgba(0,0,0,.15);
      border: 1px solid rgba(255,255,255,.55);
      position: relative;

      max-height: calc(100svh - 32px);
      overflow: auto;
      scrollbar-width: none;
      overscroll-behavior: contain;
    }
    .card::-webkit-scrollbar { display: none; }

    .card::after {
      content: "";
      display: block;
      margin-top: 14px;
      height: 1px;
      width: 100%;
      background: linear-gradient(to right, transparent, rgba(17,24,39,.18), transparent);
      opacity: .7;
    }

    .art {
      width: min(240px, 70vw);
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 22px;
      border: 3px solid rgba(255,255,255,0.75);
      box-shadow: 0 14px 34px rgba(0,0,0,.18);
      margin: 0 auto 10px;
      display: block;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
    }

    h1 {
      font-size: clamp(26px, 4vw, 44px);
      margin: 12px 0 10px;
    }

    .sub {
      margin: 0 0 12px;
      font-size: 14px;
      opacity: .8;
    }

    .button-zone {
      position: relative;
      width: min(520px, 92%);
      height: 210px;
      margin: 0 auto;
      touch-action: none;
    }

    button {
      position: absolute;
      padding: 16px 24px;
      font-size: 18px;
      font-weight: 800;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: background .12s ease, filter .12s ease, transform .22s ease;
      will-change: transform, left, top;
      white-space: nowrap;
    }

    #yesBtn {
      left: 16%;
      top: 50%;
      transform: translateY(-50%) scale(1);
      transform-origin: left center;
      background: var(--yes);
      color: #fff;
      outline: none;
    }
    #yesBtn:hover { background: var(--yesHover); }
    #yesBtn.growGlow { filter: drop-shadow(0 0 18px rgba(255, 59, 122, 0.55)); }

    #noBtn {
      left: 64%;
      top: 50%;
      transform: none;
      background: #e5e7eb;
      color: #111827;
      transition: left .09s ease-out, top .09s ease-out, background .12s ease, transform .22s ease;
    }
    #noBtn.taunt {
      background: #111827;
      color: #fff;
      font-size: 12px;
      padding: 12px 14px;
    }

    .hint {
      margin-top: 10px;
      padding-bottom: 6px;
      opacity: .8;
      display: grid;
      gap: 6px;
      justify-items: center;
    }
    .hint-line {
      font-size: 13px;
      line-height: 1.2;
      opacity: .92;
      animation: popLine .18s ease-out;
      padding: 2px 8px;
      border-radius: 10px;
    }
    @keyframes popLine {
      from { transform: translateY(4px); opacity: 0; }
      to { transform: translateY(0); opacity: .92; }
    }

    .result {
      display: none;
      margin-top: 18px;
      animation: pop .35s ease;
    }
    .result h2 {
      font-size: clamp(30px, 4.5vw, 46px);
      margin: 8px 0 10px;
    }

    /* This is the "media slot" for BOTH gif and slideshow */
    .mediaSlot {
      width: min(380px, 90vw);
      margin: 0 auto;
      border-radius: 14px;
      box-shadow: 0 12px 28px rgba(0,0,0,.18);
      overflow: hidden;
      background: rgba(255,255,255,.65);
    }

    .fireworks {
      width: 100%;
      height: auto;
      display: block;
    }

    .slideshowImg {
      width: 100%;
      height: auto;
      max-height: 52vh;
      object-fit: contain;
      display: block;
      background: rgba(0,0,0,.03);
      opacity: 1;
      transition: opacity .35s ease;
    }

    .slideMeta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      font-size: 12.5px;
      font-weight: 800;
      opacity: .86;
      border-top: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(8px);
    }

    @keyframes pop {
      from { transform: scale(.96); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @media (max-height: 760px) {
      .card { padding: 18px 18px 22px; }
      .art { width: min(200px, 62vw); border-radius: 18px; }
      h1 { font-size: clamp(22px, 3.6vw, 38px); margin: 10px 0 8px; }
      .sub { font-size: 13px; margin-bottom: 10px; }
      .button-zone { height: 180px; }
      button { padding: 14px 20px; font-size: 16px; }
      .mediaSlot { width: min(320px, 86vw); }
      .slideshowImg { max-height: 42vh; }
    }

    @media (prefers-reduced-motion: reduce) {
      button { transition: none; }
      .result { animation: none; }
      .hint-line { animation: none; }
      .slideshowImg { transition: none; }
    }

    /* ---------------- CAPTCHA OVERLAY ---------------- */
    #captchaOverlay {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 14px;
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(4px);
      z-index: 9500;
      transition: opacity .22s ease;
    }
    #captchaOverlay.hide { opacity: 0; pointer-events: none; }

    .capCard {
      width: min(660px, 96vw);
      max-height: 86vh;
      overflow: auto;
      background: #fff;
      border: 1px solid var(--capBorder);
      border-radius: 6px;
      box-shadow: 0 18px 55px rgba(0,0,0,.25);
      padding: 0;
      text-align: left;
      -webkit-overflow-scrolling: touch;
      font-family: Arial, system-ui, sans-serif;
      color: var(--capText);
    }

    .capHeader {
      position: sticky;
      top: 0;
      z-index: 3;
      background: var(--capBlue);
      color: #fff;
      padding: 14px 14px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      justify-content: space-between;
    }
    .capHeaderText .capTitle {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
      line-height: 1.25;
      color: #fff;
    }
    .capHeaderText .capSub {
      margin: 6px 0 0;
      font-size: 13px;
      opacity: .95;
      color: #fff;
      line-height: 1.25;
    }
    .capThumb {
      width: 70px;
      height: 70px;
      flex: 0 0 auto;
      border: 2px solid rgba(255,255,255,.9);
      border-radius: 4px;
      overflow: hidden;
      background: rgba(255,255,255,.2);
    }
    .capThumb img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .capGridWrap { background: var(--capBg); padding: 12px; }
    .capGrid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      background: #fff;
      padding: 6px;
      border: 1px solid var(--capBorder);
    }
    .capTile {
      aspect-ratio: 1 / 1;
      border: 0;
      border-radius: 2px;
      background: #fff;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      padding: 0;
      box-shadow: none;
      transition: outline .08s ease, transform .08s ease;
    }
    .capTile:hover { transform: translateY(-1px); }
    .capTile img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .capTile.selected { outline: 3px solid var(--capBlue); outline-offset: -3px; }
    .capTile .check {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: 900;
      font-size: 16px;
      background: rgba(255,255,255,.95);
      border: 1px solid rgba(26,115,232,.22);
      opacity: 0;
      transform: scale(.92);
      transition: opacity .10s ease, transform .10s ease;
      color: rgba(255,59,122,.95);
    }
    .capTile.selected .check { opacity: 1; transform: scale(1); }
    .capTile .check::before { content: "ü§ç"; }

    .capFooterWrap {
      position: sticky;
      bottom: 0;
      z-index: 3;
      background: var(--capBg);
      border-top: 1px solid var(--capBorder);
    }

    .capFooter {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 12px;
    }
    .capLeft { display: flex; gap: 10px; align-items: center; }

    .capIconBtn {
      position: static;
      border: none;
      background: transparent;
      padding: 6px;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      color: #5f6368;
      box-shadow: none;
      border-radius: 6px;
    }
    .capIconBtn:hover { background: rgba(32,33,36,.08); }

    .capRight {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .capStatus {
      font-size: 12.5px;
      color: #5f6368;
      font-weight: 700;
      white-space: nowrap;
    }
    .verifyBtn {
      position: static;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 800;
      border-radius: 4px;
      border: 1px solid rgba(0,0,0,.08);
      background: var(--capBlue);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 0 rgba(0,0,0,.08);
      white-space: nowrap;
    }
    .verifyBtn:hover { filter: brightness(.96); }

    .capMsg {
      padding: 0 12px 10px;
      font-size: 12.5px;
      font-weight: 800;
      min-height: 18px;
      color: #5f6368;
    }
    .capMsg.error { color: var(--capWarn); }
    .capMsg.ok { color: var(--capOk); }

    .shakeCard { animation: shake .18s linear 2; }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      50% { transform: translateX(4px); }
      75% { transform: translateX(-3px); }
      100% { transform: translateX(0); }
    }

    /* ---------------- SOUND / FULLSCREEN OVERLAY ---------------- */
    #startOverlay {
      position: fixed;
      inset: 0;
      display: none;
      place-items: center;
      padding: 14px;
      background: rgba(17,24,39,.25);
      backdrop-filter: blur(6px);
      z-index: 9600;
    }
    .startCard {
      width: min(540px, 96vw);
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.65);
      border-radius: 18px;
      box-shadow: 0 22px 70px rgba(0,0,0,.25);
      padding: 14px;
      text-align: left;
    }
    .startTitle {
      margin: 0;
      font-size: 15px;
      font-weight: 950;
      color: #111827;
    }
    .startSub {
      margin: 6px 0 12px;
      font-size: 12.5px;
      opacity: .85;
      line-height: 1.35;
    }
    .startBtns {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
    }
    .startBtn {
      position: static;
      padding: 10px 14px;
      font-size: 13px;
      font-weight: 950;
      border-radius: 999px;
      border: 1px solid rgba(17,24,39,.12);
      background: rgba(255,255,255,.95);
      cursor: pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.10);
      transition: transform .10s ease;
      white-space: nowrap;
    }
    .startBtn:hover { transform: translateY(-1px); }
    .startBtn.primary {
      border-color: rgba(255,59,122,.25);
      background: rgba(255,59,122,.10);
    }
    .startNote {
      margin-top: 10px;
      font-size: 12.5px;
      font-weight: 900;
      opacity: .85;
    }

    /* Slideshow toggle button (top-right, only after YES) */
    #slideshowBtn {
      display: none;
      position: fixed;
      top: 14px;
      right: 14px;
      transform: none;
      z-index: 9200;
      padding: 10px 14px;
      font-size: 13px;
      font-weight: 950;
      border-radius: 999px;
      border: 1px solid rgba(17,24,39,.12);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
      color: #111827;
      cursor: pointer;
      white-space: nowrap;
    }
    #slideshowBtn:hover { filter: brightness(.98); }
  </style>
</head>

<body>
  <canvas id="confettiCanvas"></canvas>

  <!-- Slideshow toggle button -->
  <button id="slideshowBtn" type="button">Click here for slideshow üì∏ü§ç</button>

  <!-- Fake Captcha Pop-up -->
  <div id="captchaOverlay" role="dialog" aria-modal="true" aria-labelledby="capTitle">
    <div class="capCard" id="capCard">
      <div class="capHeader">
        <div class="capHeaderText">
          <p class="capTitle" id="capTitle">Select all images of the best boyfriend ever ü´µ</p>
          <p class="capSub">Click verify to continue once all selected üêùü§ç</p>
        </div>
        <div class="capThumb" aria-hidden="true">
          <img src="y1.jpg" alt="" />
        </div>
      </div>

      <div class="capGridWrap">
        <div class="capGrid" id="captchaGrid"></div>
      </div>

      <div class="capFooterWrap">
        <div class="capFooter">
          <div class="capLeft" aria-hidden="true">
            <button class="capIconBtn" type="button" title="Reload">‚ü≤</button>
            <button class="capIconBtn" type="button" title="Audio">üéß</button>
            <button class="capIconBtn" type="button" title="Info">‚ìò</button>
          </div>

          <div class="capRight">
            <div class="capStatus" id="capStatus">Selected 0/9</div>
            <button class="verifyBtn" id="verifyBtn" type="button">Verify ‚úÖ</button>
          </div>
        </div>
        <div class="capMsg" id="capMsg"></div>
      </div>
    </div>
  </div>

  <!-- Sound/Fullscreen Pop-up (after captcha) -->
  <div id="startOverlay" role="dialog" aria-modal="true" aria-labelledby="startTitle">
    <div class="startCard">
      <p class="startTitle" id="startTitle">One sec üêù</p>
      <p class="startSub">
        Turn your sound ON üîä for the full vibe ü§ç<br />
        Full screen is optional but looks cleaner üò∂‚Äçüå´Ô∏è
      </p>

      <div class="startBtns">
        <button class="startBtn" id="testSoundBtn" type="button">Test sound üîä</button>
        <button class="startBtn primary" id="fsBtn" type="button">Full screen + continue ü´µ</button>
        <button class="startBtn" id="continueBtn" type="button">Continue</button>
      </div>

      <div class="startNote" id="startNote"></div>
    </div>
  </div>

  <div id="app" class="locked">
    <main class="card">
      <img id="photo" class="art" src="us.jpg" alt="Us ü§ç" />

      <h1 id="titleText">Hey Anadya üêù, will you be my Valentine? ü§ç</h1>
      <p class="sub" id="subText">Choose wisely ü´µ (I challenge you to pick "No" üò∂‚Äçüå´Ô∏è)</p>

      <section class="button-zone" id="zone">
        <button id="yesBtn">YES ü•πü•±ü§ç</button>
        <button id="noBtn">No</button>
      </section>

      <div class="hint" id="hint">
        <div class="hint-line" id="starterHint">‚ÄúNo‚Äù will act a little strange fyi üòà</div>
      </div>

      <section class="result" id="result">
        <h2>YAYYY!! üéâüí• you‚Äôre my üêêü§ç</h2>
        <h3>Happy Valentines my b, celebrating you today and everyday</h3>

        <!-- MEDIA SLOT: either GIF or slideshow -->
        <div class="mediaSlot" id="mediaSlot">
          <img
            id="fireworksGif"
            class="fireworks"
            src="https://media.giphy.com/media/26ufdipQqU2lhNA4g/giphy.gif"
            alt="Fireworks"
          />

          <div id="slideshowArea" style="display:none;">
            <img class="slideshowImg" id="slideshowImg" alt="Slideshow" />
            <div class="slideMeta">
              <span id="slideCounter">1/18</span>
              <span>ü§ç</span>
            </div>
          </div>
        </div>

        <div class="hint" style="margin-top:12px; opacity:.85;">
          <div class="hint-line">screenshot this pls üòå</div>
        </div>
      </section>

      <audio id="songAudio" src="song.mp3" preload="auto"></audio>
    </main>
  </div>

  <script>
    const zone = document.getElementById("zone");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const result = document.getElementById("result");
    const hintBox = document.getElementById("hint");
    const songAudio = document.getElementById("songAudio");
    const subText = document.getElementById("subText");
    const titleText = document.getElementById("titleText");

    const starterHint = document.getElementById("starterHint");
    let starterHintHidden = false;

    const app = document.getElementById("app");

    // Captcha elements
    const captchaOverlay = document.getElementById("captchaOverlay");
    const captchaGrid = document.getElementById("captchaGrid");
    const verifyBtn = document.getElementById("verifyBtn");
    const capStatus = document.getElementById("capStatus");
    const capMsg = document.getElementById("capMsg");
    const capCard = document.getElementById("capCard");

    // Start overlay elements
    const startOverlay = document.getElementById("startOverlay");
    const fsBtn = document.getElementById("fsBtn");
    const continueBtn = document.getElementById("continueBtn");
    const testSoundBtn = document.getElementById("testSoundBtn");
    const startNote = document.getElementById("startNote");

    // Slideshow elements (replaces GIF)
    const slideshowBtn = document.getElementById("slideshowBtn");
    const fireworksGif = document.getElementById("fireworksGif");
    const slideshowArea = document.getElementById("slideshowArea");
    const slideshowImg = document.getElementById("slideshowImg");
    const slideCounter = document.getElementById("slideCounter");

    // Build 3x3 grid from y1.jpg ... y9.jpg
    const selected = new Set();

    function updateCapStatus() {
      capStatus.textContent = `Selected ${selected.size}/9`;
    }

    function makeTile(i) {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "capTile";
      btn.setAttribute("aria-pressed", "false");
      btn.dataset.i = String(i);

      const img = document.createElement("img");
      img.src = `y${i}.jpg`;
      img.alt = `y${i}`;

      const check = document.createElement("div");
      check.className = "check";

      btn.appendChild(img);
      btn.appendChild(check);

      btn.addEventListener("click", () => {
        const key = String(i);
        if (selected.has(key)) {
          selected.delete(key);
          btn.classList.remove("selected");
          btn.setAttribute("aria-pressed", "false");
        } else {
          selected.add(key);
          btn.classList.add("selected");
          btn.setAttribute("aria-pressed", "true");
        }
        capMsg.textContent = "";
        capMsg.className = "capMsg";
        updateCapStatus();
      });

      return btn;
    }

    for (let i = 1; i <= 9; i++) captchaGrid.appendChild(makeTile(i));
    updateCapStatus();

    function showStartOverlay() {
      startOverlay.style.display = "grid";
      startNote.textContent = "";
    }

    function unlockApp() {
      startOverlay.style.display = "none";
      app.classList.remove("locked");
      yesBtn.focus();
    }

    async function goFullscreen() {
      try {
        if (!document.fullscreenElement) {
          await document.documentElement.requestFullscreen();
        }
        startNote.textContent = "Full screen: ON ‚úÖ";
      } catch (e) {
        startNote.textContent = "Full screen blocked (no worries) üò∂‚Äçüå´Ô∏è";
      }
    }

    testSoundBtn.addEventListener("click", async () => {
      try {
        songAudio.currentTime = 0;
        songAudio.volume = 1.0;
        await songAudio.play();
        startNote.textContent = "If you heard that, sound is ON üîäü§ç";
        setTimeout(() => {
          try { songAudio.pause(); songAudio.currentTime = 0; } catch (_) {}
        }, 900);
      } catch (e) {
        startNote.textContent = "If you didn‚Äôt hear it, unmute üîä (then try again) ü´µ";
      }
    });

    fsBtn.addEventListener("click", async () => {
      await goFullscreen();
      unlockApp();
    });

    continueBtn.addEventListener("click", () => unlockApp());

    verifyBtn.addEventListener("click", () => {
      if (selected.size === 9) {
        capMsg.textContent = "Verified ü§ç (correct answer: YOU ü´µ)";
        capMsg.className = "capMsg ok";

        captchaOverlay.classList.add("hide");
        setTimeout(() => {
          captchaOverlay.style.display = "none";
          showStartOverlay();
        }, 220);
      } else {
        capMsg.textContent = "Select ALL of them üò≠ (best boyfriend check failed)";
        capMsg.className = "capMsg error";

        capCard.classList.add("shakeCard");
        setTimeout(() => capCard.classList.remove("shakeCard"), 260);
      }
    });

    /* ---------- CONFETTI ---------- */
    const confettiCanvas = document.getElementById("confettiCanvas");

    function resizeConfettiCanvas() {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
      confettiCanvas.style.width = "100vw";
      confettiCanvas.style.height = "100vh";
    }

    resizeConfettiCanvas();
    window.addEventListener("resize", resizeConfettiCanvas);
    window.addEventListener("orientationchange", () => setTimeout(resizeConfettiCanvas, 150));

    const confettiInstance = confetti.create(confettiCanvas, { resize: false, useWorker: true });

    function fireworkConfetti() {
      const duration = 2200;
      const end = Date.now() + duration;

      (function frame() {
        confettiInstance({
          particleCount: 55,
          startVelocity: 60,
          spread: 360,
          ticks: 120,
          scalar: 1.1,
          origin: { x: Math.random(), y: Math.random() * 0.5 }
        });
        if (Date.now() < end) requestAnimationFrame(frame);
      })();

      setTimeout(() => {
        confettiInstance({
          particleCount: 420,
          startVelocity: 75,
          spread: 360,
          ticks: 220,
          scalar: 1.2,
          origin: { x: 0.5, y: 0.55 }
        });
      }, 650);
    }

    /* ---------- Hint stacking ---------- */
    const milestones = [
      { at: 3, msg: "bro‚Ä¶ just press YES üò≠" },
      { at: 6, msg: "the NO button said: üèÉüí®" },
      { at: 9, msg: "Anadya üêù ‚Ä¶ please say yes üò≠" }
    ];

    function addHintLine(text) {
      if (!starterHintHidden && starterHint) {
        starterHint.style.display = "none";
        starterHintHidden = true;
      }

      const exists = Array.from(hintBox.querySelectorAll(".hint-line"))
        .some(el => el.textContent === text);
      if (exists) return;

      const line = document.createElement("div");
      line.className = "hint-line";
      line.textContent = text;

      const count = hintBox.querySelectorAll(".hint-line").length + 1;
      const size = Math.min(20, 13 + (count - 1) * 2);
      line.style.fontSize = size + "px";

      hintBox.appendChild(line);
    }

    /* ---------- YES BUTTON GROWS ---------- */
    let yesScale = 1;
    const YES_MAX = 2.2;
    let started = false;
    let lastPointerTime = 0;

    function setYesScale(s) {
      yesScale = Math.min(YES_MAX, s);
      yesBtn.classList.toggle("growGlow", yesScale > 1.12);
      yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;
    }

    let lastTick = performance.now();
    function tick(now) {
      const dt = now - lastTick;
      lastTick = now;

      if (started && (now - lastPointerTime) < 450 && yesScale < YES_MAX) {
        const growthPerMs = 0.00012;
        setYesScale(yesScale + dt * growthPerMs);
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    /* ---------- NO BUTTON RUNS AWAY ---------- */
    function clamp(n, min, max) {
      return Math.max(min, Math.min(max, n));
    }

    function getNoPos() {
      return {
        left: parseFloat(noBtn.style.left || "0"),
        top:  parseFloat(noBtn.style.top  || "0")
      };
    }

    function setNoPos(left, top) {
      noBtn.style.left = left + "px";
      noBtn.style.top  = top  + "px";
      noBtn.style.transform = "none";
    }

    function placeNoInitial() {
      const z = zone.getBoundingClientRect();
      const w = noBtn.offsetWidth;
      const h = noBtn.offsetHeight;

      const left = clamp(z.width * 0.60 + Math.random() * (z.width * 0.30), 0, z.width - w);
      const top  = clamp(z.height * 0.25 + Math.random() * (z.height * 0.50), 0, z.height - h);

      setNoPos(left, top);
    }
    window.addEventListener("load", () => setTimeout(placeNoInitial, 30));

    const pointer = { active: false, x: 0, y: 0 };

    zone.addEventListener("pointerenter", () => { pointer.active = true; started = true; });
    zone.addEventListener("pointerleave", () => { pointer.active = false; });
    zone.addEventListener("pointermove", (e) => {
      pointer.active = true;
      pointer.x = e.clientX;
      pointer.y = e.clientY;
      lastPointerTime = performance.now();
    });

    let dodgeCount = 0;
    let lastBump = 0;

    function bumpDodgeCount() {
      const now = performance.now();
      if (now - lastBump < 280) return;
      lastBump = now;
      dodgeCount++;

      for (const m of milestones) {
        if (dodgeCount === m.at) addHintLine(m.msg);
      }
    }

    function dodgeLoop() {
      if (pointer.active) {
        const z = zone.getBoundingClientRect();
        const b = noBtn.getBoundingClientRect();

        const btnCx = b.left + b.width / 2;
        const btnCy = b.top  + b.height / 2;

        const dx = pointer.x - btnCx;
        const dy = pointer.y - btnCy;
        const dist = Math.hypot(dx, dy);

        const danger = 130;
        if (dist < danger) {
          const ux = dx / (dist || 1);
          const uy = dy / (dist || 1);

          const push = (danger - dist) * 1.6 + 10;

          const pos = getNoPos();
          const w = noBtn.offsetWidth;
          const h = noBtn.offsetHeight;

          let newLeft = pos.left - ux * push + (Math.random() - 0.5) * 10;
          let newTop  = pos.top  - uy * push + (Math.random() - 0.5) * 10;

          newLeft = clamp(newLeft, 0, z.width - w);
          newTop  = clamp(newTop,  0, z.height - h);

          setNoPos(newLeft, newTop);
          bumpDodgeCount();
        }
      }
      requestAnimationFrame(dodgeLoop);
    }
    requestAnimationFrame(dodgeLoop);

    /* ---------- If they click NO: replace NO text briefly ---------- */
    let tauntTimeout = null;
    const originalNoText = noBtn.textContent;

    function tauntNoButton() {
      noBtn.classList.add("taunt");
      noBtn.textContent = "nice try üò∂‚Äçüå´Ô∏è (you can‚Äôt pick NO)";
      if (tauntTimeout) clearTimeout(tauntTimeout);
      tauntTimeout = setTimeout(() => {
        noBtn.classList.remove("taunt");
        noBtn.textContent = originalNoText;
      }, 900);
    }

    noBtn.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      tauntNoButton();
      bumpDodgeCount();
    });
    noBtn.addEventListener("click", (e) => e.preventDefault());

    /* ---------------- Slideshow logic (1.jpg ... 18.jpg) ---------------- */
    const slideFiles = Array.from({ length: 18 }, (_, i) => `${i + 1}.jpg`);
    let slideIndex = 0;
    let slideTimer = null;
    let slideshowOn = false;

    (function preloadSlides() {
      slideFiles.forEach(src => { const img = new Image(); img.src = src; });
    })();

    function showSlide(i) {
      slideshowImg.style.opacity = "0";
      setTimeout(() => {
        slideshowImg.src = slideFiles[i];
        slideCounter.textContent = `${i + 1}/${slideFiles.length}`;
        slideshowImg.onload = () => { slideshowImg.style.opacity = "1"; };
      }, 160);
    }

    function startSlideshow() {
      slideshowOn = true;
      slideshowBtn.textContent = "Stop slideshow ‚úãü§ç";

      // swap GIF -> slideshow in same slot
      fireworksGif.style.display = "none";
      slideshowArea.style.display = "block";

      slideIndex = 0;
      showSlide(slideIndex);

      if (slideTimer) clearInterval(slideTimer);
      slideTimer = setInterval(() => {
        slideIndex = (slideIndex + 1) % slideFiles.length;
        showSlide(slideIndex);
      }, 3500);
    }

    function stopSlideshow() {
      slideshowOn = false;
      slideshowBtn.textContent = "Click here for slideshow üì∏ü§ç";

      // swap slideshow -> GIF
      slideshowArea.style.display = "none";
      fireworksGif.style.display = "block";

      if (slideTimer) clearInterval(slideTimer);
      slideTimer = null;
    }

    slideshowBtn.addEventListener("click", () => {
      if (!slideshowOn) startSlideshow();
      else stopSlideshow();
    });

    /* ---------- YES CLICK ---------- */
    yesBtn.addEventListener("click", () => {
      try {
        if (songAudio.paused) {
          songAudio.volume = 1.0;
          songAudio.play().catch(() => {});
        }
      } catch (e) {}

      titleText.style.display = "none";
      subText.style.display = "none";

      zone.style.display = "none";
      hintBox.style.display = "none";
      result.style.display = "block";

      // show slideshow button (slideshow stays OFF until clicked)
      slideshowBtn.style.display = "block";

      resizeConfettiCanvas();
      fireworkConfetti();
    });
  </script>
</body>
</html>